[General]
SyntaxVersion=2
BeginHotkey=120
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=121
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=3ecd1731-189f-42a9-9178-9e43aed7b21c
Description=结界突破
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[Attachment]
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


[UIPackage]
UEsDBBQAAgAIAESdzkrHcFsqgQMAAAgkAAAJABEAVUlQYWNrYWdlVVQNAAeKkUFZipFBWYqRQVntWM1PE0EUf9vy0RZsS4WCfFlU1HjSu5oIEUOCX7R4MNGkYkViKWRBgzf/E+PZiybeDPHGSaPxL4AD8eqJm9Tf7M7aKYE4b2bJhqSPPAa2nf3N+35v4uTTj+89W+8+Dm7TPrpOcdqrJ6lDeeZI9ihLFJP/79Xr9eBxvUXHiv6A26QNha3bwZ3gJDgBToFPgLvA3eC0b3rKyD17LRUea5qlZfysUYFuUg2rS6+JQ3l4TPAu5z/f/X1/7lp856cTx99vEv6zOZqmy2ROCXKcAD92yHe2Lvm4Ab762SSVaMbiBCmJ3y9jh4tfgr5XqEJ3qExLWLmUo5iH3yNzr+6+NrkGMRw1tygamlp2lyzCj8T+Kxb7HbIj2/229OnD1x0b+RkheyT7TfNOI//Fmno+XZsFuVJUnTI9oarhGdLIf12yT9HFjyn57wEt0irY9ARZA/njCv4sUMv0lO5CD1Vm7Q3yf7d8py5+m4JfAv466r6F/R2u/O2K/SfRfVTBruFJeg3wOxT5G/gTsMM8veDje/1yhqH/zn32n7fUv+jPEwz8BPk9vEqPEBS7dPyoM2L83YN17pWl28VCsVxbLRQr7uKzI8Iff//Yav9DZB4X+aeC3yYk8m+fjCld/0sq/j+D2ONHXbP/Z+X7dPFTB8Z/Eed4Dj3wquEA4v8kiTysj9+l4N9A97/i1QAXXMMZeFUoD/mT5M/luvjdCv4UZK/Z5R92/RP56uo/+auovgs4g9B7zST/s/HTTfYvQ/9rOIPQw4Rnh6ASNHzjcLoI/eepce+lg59R8Ce89/vxp4N3gP85vUz8rIJvmz9s+09bKi0uVVyL/RvbG7++fd7cjOr8Uc8vJXj+mtf7mnifl3/Y8dej+N894K8DvYou3ITSBvi5ffii/3oJuU1uYQYM8NX7cv/+yXyCTMGDAuzBQ74T3Dsd5f0TR35RL4P+P4r5U+RLef0YyvxZwHqa9OtvH4U6fzpjWM8z8PMU6vxJQ14c6OP3U7TzZ3P8hTN/XmDIP0Chzp/OMNZzDPxTCr4t2fYPb5GNbmH9gnXBYH/U9TMeMb7t/BnG/cMZrCMM/xukxv1DCPMnO/8PUbjz57iMKV38YQp1/mTnvxEKdf6kUaxnGfKPUrTzp6jVwfw57aEL73sF+ats/JwBfkGRfxoaFxow677N5t8xBb+QS1nln6jnvxbZ0V9QSwECFwsUAAIACABEnc5Kx3BbKoEDAAAIJAAACQAJAAAAAAAAAAAAAIAAAAAAVUlQYWNrYWdlVVQFAAeKkUFZUEsFBgAAAAABAAEAQAAAALkDAAAAAA==


[Script]
Delay 1000
/*************************************************************/
gold=1//勋章数不超过这个值
/*************************************************************/
Hwnd=Plugin.Window.Find(0,"阴阳师 - MuMu模拟器")
If Hwnd=0 Then
    Hwnd=Plugin.Window.Find(0,"#1 阴阳师 - MuMu模拟器")
ElseIf Hwnd=0 Then
    Hwnd=Plugin.Window.Find(0,"#2 阴阳师 - MuMu模拟器")
ElseIf Hwnd=0 Then
    Hwnd=Plugin.Window.Find(0,"#3 阴阳师 - MuMu模拟器")
    MessageBox "没有找到窗口"
    ExitScript
End If
Global gold
Global Hwnd
miniHwnd = Plugin.Window.FindEx(Hwnd, 0, "Qt5QWindowIcon", "")
sRect = Plugin.Window.GetClientRect(Hwnd)
arr = Split(sRect, "|")
X = arr(0)
Y = arr(1)
hHwnd = arr(3) - arr(1)
sRect = Plugin.Window.GetClientRect(miniHwnd)
arr = Split(sRect, "|")
hmini = arr(3) - arr(1)
If hHwnd-hmini=76 Then
    //fullwindows
    Call Plugin.Window.Size(Hwnd, 1026, 652)
    While 1
        Call 结界突破(1)    
        Delay 520000
    Wend
Else
    //miniwindows
    Call Plugin.Window.Size(Hwnd, 410, 260)
    MessageBox "不再支持mini窗口"
    ExitScript
End If
Function BackgroundPointColor(stdcolor, x, y)
    Call Plugin.Color.ColorToRGB(stdcolor, R1, G1, B1)
    backgroundColor = Plugin.Bkgnd.GetPixelColor(Hwnd, x, y)
    Call Plugin.Color.ColorToRGB(backgroundColor, R2, G2, B2)
    R = R1 - R2
    G = G1 - G2
    B = B1 - B2
    If - colorDelta  < R < colorDelta and - colorDelta  < G < colorDelta and - colorDelta  < B < colorDelta Then 
        BackgroundPointColor = True
    Else 
        BackgroundPointColor = False
    End If
End Function
Sub 结界突破(num)
    TracePrint "tp" & num
    Rem st
    GetColor = Plugin.Bkgnd.GetPixelColor(Hwnd, 987, 308)
    Select Case GetColor
    Case "8F9EA9"//处在个人界面
        Call Plugin.Window.Top(Hwnd, 0)
        Call Plugin.Window.Active(Hwnd)
        MoveTo X + 987, Y + 308
        LeftClick 1
        Delay 3000
        Goto st
    Case "596265"//上次没进入战斗
        Call Plugin.Window.Top(Hwnd, 0)
        Call Plugin.Window.Active(Hwnd)
        MoveTo X + 950, Y + 90
        LeftClick 1
        Delay 3000
        MoveTo X + 340, Y + 570
        LeftClick 1
        Delay 3000
        Goto st
    Case "D8EEF6"//阴阳寮界面
        Call Plugin.Window.Top(Hwnd, 0)
        Call Plugin.Window.Active(Hwnd)
        If num = 3 Then 
            MoveTo X + 200, Y + 50+150*num
            LeftClick 1
            Delay 3000
            Call 勋章检查
        Else 
            MoveTo X + 200, Y + 50+150*num
            LeftClick 1
            Delay 3000
            Call 勋章检查
            //等打完的时候开始下一个
            While Plugin.Bkgnd.GetPixelColor(Hwnd, 987, 308) <> "D8EEF6"
                Delay 1000
            Wend
            Call 结界突破(num + 1)                
        End If
    Case Else
        Exit Sub
    End Select
    Call Plugin.Window.Top(Hwnd, 1)	
End Sub
Function 勋章检查
    Num = - 10 
    i=0
    //检测缺少几个勋章
    For 50
        i = i + 1
        If i > 50 Then 
            Exit Function
        End If
        Num = Plugin.Bkgnd.CountBlockNum(Hwnd, 460, 150, 620, 220, "8DA3B3", 0.9)
        fail =Plugin.Bkgnd.CountBlockNum(Hwnd, 580, 120, 650, 220, "00041F", 0.8)
        TracePrint "num=" & num & "fail=" & fail
        If (5 - Num) <= gold and fail = 0 Then 
            MoveTo X + 580, Y + 160
            LeftClick 1
            Delay 2000
            XY = Plugin.Bkgnd.FindPic(Hwnd, 520, 130, 650, 300, "Attachment:\攻击.bmp", 0, 0.3)
            iZB = InStr(XY, "|")
            picX = CLng(Left(XY, iZB - 1))
            picY = CLng(Right(XY, Len(XY) - iZB))
            TracePrint XY
            If picY > 0 Then 
                MoveTo X + picX, Y + picY
                LeftClick 1
                Delay 2000
            Else 
                Call Plugin.Window.SendKeyPress(Hwnd, 32)
            End If
            Exit Function           
        Else 
            MoveTo X+480,Y+400
            LeftDown 1
            MoveR 0, -108
            LeftUp 1
            Delay 2000
        End If
    Next
End Function
Sub OnScriptExit()
    //取消窗口置顶
    Call Plugin.Window.Top(Hwnd, 1)
End Sub
Event Form1.结界突破.Timer
    Call 结界突破(1)
End Event
